{% extends "base.html" %}
{% load crispy_forms_filters %}

{% block content %}
  <div style="text-align:left;">

    <h3>{{ post.title }}</h3>
    <p style="font-size: 13px;">{{ post.owner.username }} at {{ post.created_time }}</p>
    <hr style="border-top: 1px solid rgba(255, 255, 255, .5);">

    <p><i>{{ post.content }}</i></p>
    <hr>

    <p style="text-align:left;">{{ comments.count }} comment{{ comments.count|pluralize }}</p>
    {% for comment in comments %}
      <div class="border comments" style="padding: 10px;">
        <p class="font-weight-bolt">
          {{ comment.user.username }}
          <span style="font-size: 13px" class="text-muted font-weight-normal">
            {{ comment.created_time }}
          </span>
        </p>
        <hr style="border-top: 1px solid rgba(255, 255, 255, .5);">
        <p>{{ comment.content|linebreaks }}</p>
      </div>
    {% endfor %}
    <br>

    {% if user.is_authenticated %}

      <p style="border: 2px solid #f1f1f1; width: fit-content; padding: 10px; cursor: pointer;"
         onclick="handleComment({{ post.id }})">
        Add a new comment
      </p>

      <div id="comment-container-{{ post.id }}" style="display:none">
        <form action="" method="post">
          {% csrf_token %}
          {{ comment_form.as_p }}
          <input class="btn btn-outline-light" type="submit" value="Submit">
          <input class="btn btn-outline-light" type="button" onclick="handleCancel({{ post.id }})" value="Cancel">
          <input type="hidden" name="next" value="{{ next }}">
        </form>

    {% else %}
        <a class="link" href="{% url 'login' %}">
          Login to add a comment
        </a>
    {% endif %}
      </div>

      <script>
        function handleComment(post_id) {
          const reply_form_container = document.querySelector(`#comment-container-${post_id}`)
          if (reply_form_container) {
            reply_form_container.style.display = 'block';
          }
        }
        function handleCancel(post_id) {
          const reply_form_container = document.querySelector(`#comment-container-${post_id}`)
          if (reply_form_container) {
            reply_form_container.style.display = 'none';
          }
        }
      </script>

  </div>

{% endblock %}
