{% extends "base.html" %}
{% load crispy_forms_filters %}

{% block title %} <title>{{ post.title }}</title>{% endblock %}

{% block content %}
  <h1>{{ post.title }} </h1>
  <p>
    <small>
    <strong>
      Created by {{ post.owner }} on {{ post.created_time }} |
      {% if post.commentaries.count %}
      {{ post.commentaries.count }} comment{{ post.commentaries.count|pluralize }}
    {% else %}
      No comments yet
    {% endif %}
    </strong>
  </small>
  </p>
  <p>{{ post.content }}</p>
  <hr>
  <h2>Comments</h2>
  {% if post.commentaries.count %}
    <ul>
      {% for comment in post.commentaries.all %}
        <li>
          <strong>{{ comment.user }}:</strong> {{ comment.content }}
          <br>
          <small>Posted on {{ comment.created_time }}</small>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>There are no comments on this post.</p>
  {% endif %}
  {% if user.is_authenticated %}
    <form method="post" action="{% url 'blog:add-comment' pk=post.pk %}" novalidate>
      {% csrf_token %}
      {{ form|crispy }}
      <button type="submit" class="btn btn-primary">Submit comment</button>
    </form>
  {% else %}
    <br>
    <a href="{% url 'login' %}?next={{ request.path }}"
       class="btn btn-primary">
      Login to add comments
    </a>
  {% endif %}
{% endblock %}
