{% extends "base.html" %}
{% load crispy_forms_filters %}

{% block title %}<title>{{ post.title }}</title>{% endblock %}

{% block content %}
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="card-title">{{ post.title }}</h2>
      <p class="text-muted mb-2">
        by <strong>{{ post.owner.username }}</strong> â€¢ {{ post.created_time|date:"M d, Y H:i" }}
      </p>
      <hr>
      <p class="card-text">{{ post.content }}</p>
    </div>
  </div>

  <h4 class="mt-5 mb-3">Comments ({{ post.commentaries.count }})</h4>
  {% if post.commentaries.all %}
    <ul class="list-group mb-4">
      {% for comment in post.commentaries.all %}
        <li class="list-group-item">
          <strong>{{ comment.user.username }}</strong>
          <small class="text-muted float-right">{{ comment.created_time|date:"M d, Y H:i" }}</small>
          <p class="mt-2 mb-0">{{ comment.content }}</p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">No comments yet. Be the first to comment!</p>
  {% endif %}

  {% if user.is_authenticated %}
    <div class="card p-3 shadow-sm">
      <h5>Add a Comment</h5>
      <form action="" method="post" novalidate>
        {% csrf_token %}
        {{ form|crispy }}
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  {% else %}
    <p class="mt-3">Please <a href="{% url 'login' %}">log in</a> to comment.</p>
  {% endif %}
{% endblock %}
